<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Honor of Kings Draft</title>
  <style>
    /* [STYLES OMITTED FOR BREVITY - WILL CONTINUE IN NEXT PART] */
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>HOK Viewer</h2>
    <a href="index.html">Dashboard</a>
    <a href="hero.html">Hero Skills</a>
    <a href="items.html">Items</a>
    <a href="draft.html">Draft</a>
    <a href="match-view.html">Match Viewer</a>
    <a href="map.html">Map</a>
  </div>
  <div class="main-content">
    <h1>Honor of Kings Draft</h1>
    <div class="draft-wrapper">
      <div class="team-column">
        <div class="ban-section" id="team1Bans"></div>
        <div class="hero-section" id="team1"></div>
      </div>
      <div class="team-column">
        <div class="ban-section" id="team2Bans"></div>
        <div class="hero-section" id="team2"></div>
      </div>
    </div>

    <!-- Strategy Display -->
    <div class="strategy-area" id="strategyArea">
      <img id="strategyImg" src="https://i.imgur.com/kkUX3a3.jpeg" />
      <div class="strategy-text" id="strategyText">
        Select a hero to see their strategy here...
      </div>
    </div>

    <!-- Lane & Role Stat Comparison Table -->
    <h2 style="text-align:center; margin-top: 40px;">Role & Lane Stat Comparison</h2>
    <div id="comparisonTable" style="overflow-x: auto; margin-top: 20px;">
      <table style="width:100%; border-collapse: collapse; background: #2a2a2a; color: #fff; font-size: 0.85rem;">
        <thead>
          <tr style="background: #1f1f1f;">
            <th style="padding: 8px; border: 1px solid #444;">Lane / Role</th>
            <th style="padding: 8px; border: 1px solid #444;">Team 1</th>
            <th style="padding: 8px; border: 1px solid #444;">Team 2</th>
          </tr>
        </thead>
        <tbody id="comparisonBody"></tbody>
      </table>
    </div>
        <!-- Hero Picker Modal -->
    <div class="modal" id="heroModal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <span class="clear-btn" onclick="clearCurrentSlot()">Clear</span>
        <div class="modal-filters">
          <select id="laneFilter" onchange="populateModal()">
            <option value="">All Lanes</option>
          </select>
          <select id="roleFilter" onchange="populateModal()">
            <option value="">All Roles</option>
          </select>
        </div>
        <div class="hero-grid" id="heroGrid"></div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://raw.githubusercontent.com/NeptuneG1/hok-caster/main/data.json";
    let heroData = [], currentSlot = null;

    async function loadHeroes() {
      const res = await fetch(API_URL);
      heroData = await res.json();
      populateFilterOptions();
      renderDraft();
      populateModal();
    }

    function populateFilterOptions() {
      const lanes = new Set(), roles = new Set();
      heroData.forEach(h => {
        if (h.Lane) lanes.add(h.Lane);
        if (h.PrimaryRole) roles.add(h.PrimaryRole);
      });
      const laneSelect = document.getElementById('laneFilter');
      const roleSelect = document.getElementById('roleFilter');
      lanes.forEach(l => laneSelect.innerHTML += `<option value="${l}">${l}</option>`);
      roles.forEach(r => roleSelect.innerHTML += `<option value="${r}">${r}</option>`);
    }

    function renderDraft() {
      for (let i = 0; i < 4; i++) {
        document.getElementById('team1Bans').appendChild(createSlot('ban'));
        document.getElementById('team2Bans').appendChild(createSlot('ban'));
      }
      for (let i = 0; i < 5; i++) {
        document.getElementById('team1').appendChild(createSlot('pick'));
        document.getElementById('team2').appendChild(createSlot('pick'));
      }
    }

    function createSlot(type) {
      const slot = document.createElement('div');
      slot.className = type === 'ban' ? 'ban-slot' : 'hero-card';
      const img = document.createElement('img');
      img.src = 'https://i.imgur.com/kkUX3a3.jpeg';
      img.className = 'hero-image';
      img.onclick = () => { currentSlot = img; openModal(); };
      slot.appendChild(img);
      if (type === 'pick') {
        const tip = document.createElement('div');
        tip.className = 'tooltip';
        tip.innerHTML = 'Skills <div class="tooltip-box"></div>';
        slot.appendChild(tip);
      }
      return slot;
    }

    function openModal() {
      document.getElementById("heroModal").style.display = "block";
      populateModal();
    }

    function closeModal() {
      document.getElementById("heroModal").style.display = "none";
      currentSlot = null;
    }

    function clearCurrentSlot() {
      if (!currentSlot) return;
      currentSlot.src = 'https://i.imgur.com/kkUX3a3.jpeg';
      currentSlot.dataset.hero = '';
      closeModal();
    }

    function populateModal() {
      const lane = document.getElementById('laneFilter').value;
      const role = document.getElementById('roleFilter').value;
      const used = Array.from(document.querySelectorAll('.hero-image')).map(i => i.dataset.hero);
      const grid = document.getElementById('heroGrid');
      grid.innerHTML = '';
      heroData.forEach(hero => {
        if ((lane && hero.Lane !== lane) || (role && hero.PrimaryRole !== role)) return;
        const container = document.createElement('div');
        container.className = 'hero-grid-item';
        const img = document.createElement('img');
        img.src = hero.ImageURL;
        img.alt = hero.Hero;
        img.title = hero.Hero;
        if (used.includes(hero.Hero)) {
          img.classList.add('disabled');
          const overlay = document.createElement('div');
          overlay.className = 'banned-overlay';
          overlay.innerText = 'USED';
          container.appendChild(overlay);
        } else {
          img.onclick = () => {
            currentSlot.src = hero.ImageURL;
            currentSlot.dataset.hero = hero.Hero;
            updateStrategy(hero);
            closeModal();
          };
        }
        container.appendChild(img);
        container.appendChild(document.createElement('div')).innerText = hero.Hero;
        grid.appendChild(container);
      });
    }

    function updateStrategy(hero) {
      const box = document.getElementById('strategyText');
      const image = document.getElementById('strategyImg');
      const strategy = (hero.Strategy || '').replace(/\n/g, '<br>');
      box.innerHTML = `<strong>${hero.Hero}</strong>:<br>${strategy}`;
      image.src = hero.ImageURL || image.src;
    }

    function updateTooltipBox(hero, tooltipBox) {
      tooltipBox.innerHTML = '';
      for (let i = 1; i <= 5; i++) {
        const name = hero[`SkillName${i}`];
        const desc = hero[`SkillDesc${i}`]?.replace(/\\n/g, '<br>');
        const type = hero[`SkillType${i}`];
        const icon = hero[`SkillURL${i}`];
        if (name && icon) {
          tooltipBox.innerHTML += `
            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 8px;">
              <img src="${icon}" alt="${name}" style="width: 28px; height: 28px; border-radius: 4px;">
              <div>
                <strong>${type || 'Skill'}: ${name}</strong><br>${desc || 'No description'}
              </div>
            </div>`;
        }
      }
    }

    function updateComparisonTable() {
      const statKeys = ['maxhealth','powerALT','physicalATK','magicalATK','physicalDEF','magicalDEF','mspd','phypierce','magpierce','ATKSPDbonus','critrate','critDMG','phylifesteal','maglifesteal','CDreduction','ATKrange','resistance','healthper5','manaper5'];
      const statLabels = ['Max Health','Max Mana','Physical ATK','Magical ATK','Physical DEF','Magical DEF','Move Speed','Phys Pierce','Magic Pierce','Atk Speed Bonus','Crit Rate','Crit DMG','Phys Lifesteal','Magic Lifesteal','CD Reduction','Attack Range','Resistance','HP Regen','Mana Regen'];

      const t1Heroes = Array.from(document.querySelectorAll('#team1 .hero-image')).map(img => img.dataset.hero);
      const t2Heroes = Array.from(document.querySelectorAll('#team2 .hero-image')).map(img => img.dataset.hero);
      const heroMap = {}; for (const h of heroData) heroMap[h.Hero] = h;
      const roleMap = {};

      for (let h of t1Heroes) {
        const data = heroMap[h];
        if (data) roleMap[data.Lane] = roleMap[data.Lane] || {};
        if (data) roleMap[data.Lane].t1 = data;
      }
      for (let h of t2Heroes) {
        const data = heroMap[h];
        if (data) roleMap[data.Lane] = roleMap[data.Lane] || {};
        if (data) roleMap[data.Lane].t2 = data;
      }

      const tbody = document.getElementById('comparisonBody');
      tbody.innerHTML = '';

      Object.keys(roleMap).forEach(role => {
        const h1 = roleMap[role].t1;
        const h2 = roleMap[role].t2;
        const row = document.createElement('tr');
        const labelCell = document.createElement('td');
        labelCell.style.padding = '8px';
        labelCell.style.border = '1px solid #444';
        labelCell.innerHTML = role;
        row.appendChild(labelCell);

        [h1, h2].forEach(hero => {
          const cell = document.createElement('td');
          cell.style.padding = '8px';
          cell.style.border = '1px solid #444';
          if (!hero) {
            cell.innerText = 'â€”';
          } else {
            const head = `<strong>${hero.Hero}</strong> (${hero.PrimaryRole})<br><br>`;
            const content = statKeys.map((k, idx) => {
              const label = statLabels[idx];
              const val = hero[k] ?? 0;
              return `<div><strong>${label}:</strong> ${val}</div>`;
            }).join('');
            cell.innerHTML = head + content;
          }
          row.appendChild(cell);
        });

        tbody.appendChild(row);
      });
    }

    setInterval(() => {
      const picked = document.querySelectorAll('.hero-card .hero-image[data-hero]').length;
      if (picked >= 10) updateComparisonTable();
    }, 1000);

    loadHeroes();
  </script>
</body>
</html>
